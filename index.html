<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        
        <title>Teste de Geolocalização</title>

        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>

        <style>
            html{
                margin: 0;
                overflow-x: hidden;
                background-color: #e9e9e9;
            }

            .container{
                width: 100%;
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                padding: 0;
                margin: 5% 0%;
            }

            .card{
                width: 80%;
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                align-items: center;
                border-radius: 20px;
                padding: 3%;
                box-shadow: 5px 5px 5px #00000050;
                background-color: #f9f9f9;
            }

            .btn-busca{
                width: 50%;
                background-color: #00b894;
                color: #fff;
                font-weight: bold;
                border-radius: 15px;
                padding: 2% 3%;
                border: none;
                transition: all 0.5s;
                font-size: 120%;
            }

            .btn-busca:hover, .btn-busca:active{
                background-color: #55efc4;
                scale: 1.1;
                box-shadow: 2px 2px 2px #636e72;
            }

            .resultado{
                width: 100%;
                display: flex;
                flex-wrap: nowrap;
                text-align: justify;
                font-size: 2em;
                align-items: center;
                flex-direction: column;
                justify-content: center;
                margin-bottom: 2%;
            }

            .resultado h3{
                margin: 1% 0%;
            }

            @media screen and (max-height: 768px){
                html {
                    padding: 0% 5%;
                }
            }

            @media screen and (min-height: 769px){
                html{
                    padding: 0% 15%;
                }
            }
        </style>
    </head>

    <body>
        <div class="container">
            <div class="card">
                <div class="resultado">
                    <h3>Seu endereço é:</h3>

                    <ol>
                        <li id="pais"></li>
                        <li id="estado"></li>
                        <li id="cidade"></li>
                        <li id="bairro"></li>
                        <li id="rua"></li>
                    </ol>
                </div>

                <button class="btn-busca" id="ver">Ver endereço</button>
            </div>
        </div>

        <script>
            var lat = null, lng = null, pais = null, uf = null, cidade = null, bairro = null, rua = null;

            function exibeDados(dados) {
                pais = dados.address.country;
                uf = dados.address.state;
                cidade = dados.address.city;
                bairro = dados.address.suburb;
                rua = dados.address.road;  

                $('.resultado').css('display', 'flex');
                $('#pais').text("Pais: "+pais);
                $('#estado').text("Estado: "+uf);
                $('#cidade').text("Cidade: "+cidade);
                $('#bairro').text("Bairro: "+bairro); 
                $('#rua').text("End.: "+rua); 
                
                console.log(dados);
            }

            function pegaEndereco(lat, lng) {
                let url = 'https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat='+lat+'&lon='+lng;
               
                axios.get(url)
                    .then((response) => {
                        exibeDados(response.data);
                    })
                    .catch(function (error) {
                        // handle error
                        console.log(error);
                    });
            }

            $(document).ready(function() {
                /// Quando usuário clicar em ver endereço será feito todos os passo abaixo      
                
                $('.resultado').css('display', 'none');

                $('#ver').click(function() {
                    if( ! 'geolocation' in navigator ) {
                        // Não suporta Geolocation HTML5...
                        alert("Não suporta Geolocation");
                    } else {
                        // Suporta Geolocation HTML5. Vamos em frente!                        
                        function geoSuccess( pos ) {
                            // armazena as coordenadas de latitude e longitude
                            lat = pos.coords.latitude;
                            lng = pos.coords.longitude;                            
                            
                            pegaEndereco(lat, lng);
                        };                        

                        function geoError( err ) {
                            switch( err.code ) {
                                case 1:
                                    // permissão negada pelo usuario
                                    break;
                                case 2:
                                    // nao foi possível alcançar os satélites GPS
                                    break;
                                case 3:
                                    // a requisição demorou demais para retornar
                                    break;
                                case 0:
                                    // ocorreu um erro desconhecido...
                                    break;
                            }
                        }

                        var geoOptions = {
                            enableHighAccuracy: true,
                            timeout: 30000,
                            maximumAge: 3000
                        };

                        navigator.geolocation.getCurrentPosition( geoSuccess, geoError, geoOptions );
                    }
                });            
            });
        </script>
    </body>
</html>